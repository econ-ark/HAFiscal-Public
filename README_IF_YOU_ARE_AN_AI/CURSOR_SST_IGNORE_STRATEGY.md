# Single Source of Truth (SST) Strategy for Ignored Files

**Created**: 2025-11-01  
**Status**: ✅ Implemented  
**Type**: SST Pattern for `.gitignore` and `.cursorindexingignore`

## Problem Statement

The HAFiscal project has two file exclusion mechanisms:
- **`.gitignore`** (494 lines) - Excludes files from Git commits
- **`.cursorindexingignore`** (226 lines) - Excludes files from Cursor indexing

**Issue**: Significant duplication and potential drift between the two files.

**Solution**: Implement Single Source of Truth (SST) pattern where `.gitignore` is the master and `.cursorindexingignore` is generated from it.

## SST Strategy

### Master Source: `.gitignore`

**Rationale**: `.gitignore` is the authoritative source for "unwanted" files
- Already well-maintained (494 lines)
- Covers LaTeX, Emacs, macOS, Python, project-specific patterns
- If a file shouldn't be in Git, it shouldn't be indexed either

### Generated Target: `.cursorindexingignore`

**Generation**: Automated from `.gitignore` + Cursor-specific additions
- Includes ALL patterns from `.gitignore`
- Adds Cursor-specific exclusions (e.g., committed PDFs)
- Prevents duplication and drift

## Implementation

### Generation Script

**Location**: `@resources/scripts/generate-cursorindexingignore.sh`

**Workflow**:
```bash
# Master source
.gitignore (494 lines)
    ↓
    ↓ [Generation Script]
    ↓
# Generated file
.cursorindexingignore (auto-generated)
    = .gitignore patterns
    + Cursor-specific additions
```

**Sections**:
1. **Section 1**: All patterns from `.gitignore` (SST)
2. **Section 2**: Cursor-specific exclusions (committed but don't index)
3. **Section 3**: Cursor-specific directories

### Makefile Integration

```bash
# Generate .cursorindexingignore from .gitignore
make cursor-indexing-ignore
```

**Auto-generation**: Consider adding to pre-commit hooks or build process

## Usage

### To Add New Exclusions

**Decision Tree**:

```
Should the file be excluded from Git?
│
├─ YES → Add to .gitignore
│        Then run: make cursor-indexing-ignore
│
└─ NO → Is it only for Cursor indexing?
        │
        ├─ YES → Add to Section 2 of generation script
        │        Then run: make cursor-indexing-ignore
        │
        └─ NO → Don't exclude it!
```

### To Regenerate

```bash
# Method 1: Via Makefile
make cursor-indexing-ignore

# Method 2: Direct execution
@resources/scripts/generate-cursorindexingignore.sh

# Method 3: Dry-run (preview without writing)
@resources/scripts/generate-cursorindexingignore.sh --dry-run
```

### After Regeneration

```bash
# Force Cursor to re-index
# Cmd+Shift+P → "Developer: Reload Window"

# Verify exclusions work
# Cmd+P → type "HAFiscal.pdf" (should NOT appear)
# Cmd+P → type "reproduce.sh" (should appear)
```

## Cursor-Specific Additions

### Category 1: Committed PDFs (in Git, not indexed)

**Problem**: Generated PDFs are committed for distribution but shouldn't be indexed

```gitignore
*.pdf
HAFiscal.pdf
HAFiscal-Slides.pdf
```

**Rationale**:
- Large binary files (1.0M + 533K)
- Frequently regenerated
- Not searchable by Cursor
- Slow down indexing

### Category 2: Documentation Build Directories

**Problem**: Build directories may exist locally but aren't in Git

```gitignore
docs/
_build/
_static/
_templates/
```

**Rationale**:
- Generated content
- Not source code
- Large and frequently changing

### Category 3: IDE Directories

**Problem**: IDE files beyond what's in `.gitignore`

```gitignore
.vscode/
.idea/
```

**Rationale**:
- User-specific configurations
- Not project source code
- May contain large temporary files

## Benefits of SST Approach

### 1. No Duplication ✅
- Single source of truth in `.gitignore`
- Generated file is clearly marked as auto-generated
- "DO NOT EDIT DIRECTLY" warning in header

### 2. No Drift ✅
- Changes to `.gitignore` automatically propagate
- Regeneration is fast (< 1 second)
- Can be automated in build process

### 3. Clear Ownership ✅
- `.gitignore` owned by Git workflow
- `.cursorindexingignore` owned by generation script
- Cursor-specific additions documented in script

### 4. Easy Maintenance ✅
- Add to `.gitignore` as usual
- Run `make cursor-indexing-ignore`
- Done!

## File Headers

### `.gitignore` Header
```gitignore
# Created by https://www.gitignore.io/api/latex,emacs,macos
# [Standard gitignore content]
```

### `.cursorindexingignore` Header
```gitignore
# ============================================================================
# Cursor AI Indexing Exclusions for HAFiscal Project
# ============================================================================
# AUTOGENERATED FROM .gitignore - DO NOT EDIT DIRECTLY
# Generated by: @resources/scripts/generate-cursorindexingignore.sh
#
# Single Source of Truth Strategy:
# - Master: .gitignore (494 lines)
# - Generated: .cursorindexingignore (this file)
# - Additions: Cursor-specific large binaries not in Git
#
# To regenerate: make cursor-indexing-ignore
# ============================================================================
```

## Automation Options

### Option 1: Manual Regeneration (Current)
```bash
# After editing .gitignore
make cursor-indexing-ignore
git add .cursorindexingignore
git commit -m "Update cursor indexing exclusions"
```

### Option 2: Pre-Commit Hook (Recommended)
```bash
# .git/hooks/pre-commit
if git diff --cached --name-only | grep -q "^\.gitignore$"; then
    echo "Regenerating .cursorindexingignore from .gitignore..."
    make cursor-indexing-ignore
    git add .cursorindexingignore
fi
```

### Option 3: CI/CD Check
```yaml
# .github/workflows/lint.yml
- name: Check cursor indexing ignore is up to date
  run: |
    make cursor-indexing-ignore
    git diff --exit-code .cursorindexingignore || \
      (echo "ERROR: .cursorindexingignore out of sync with .gitignore" && exit 1)
```

## Comparison: Before vs After SST

### Before SST (Manual Duplication)

```
.gitignore (494 lines)
  - Manual maintenance
  - Git-specific patterns

.cursorindexingignore (226 lines)
  - Manual maintenance
  - Cursor-specific patterns
  - DUPLICATION with .gitignore
  - Risk of drift
```

**Problems**:
- ❌ Duplication: ~150 lines of overlap
- ❌ Drift: Changes to one file not reflected in other
- ❌ Maintenance: Must update both files
- ❌ Confusion: Which file to update?

### After SST (Generated)

```
.gitignore (494 lines)
  ↓ [SST: Master Source]
  ↓
  ↓ [Generation Script]
  ↓ (@resources/scripts/generate-cursorindexingignore.sh)
  ↓
.cursorindexingignore (auto-generated)
  = .gitignore (494 lines)
  + Cursor-specific (30 lines)
  = Total: ~524 lines
```

**Benefits**:
- ✅ No duplication: Single source in `.gitignore`
- ✅ No drift: Generated automatically
- ✅ Easy maintenance: Update `.gitignore`, run `make`
- ✅ Clear ownership: SST pattern

## Testing

### Test 1: Verify Generation
```bash
# Regenerate
make cursor-indexing-ignore

# Check output
cat .cursorindexingignore | head -20

# Verify header says "AUTOGENERATED"
```

### Test 2: Verify Patterns Work
```bash
# Test in Cursor
# Cmd+P → "HAFiscal.pdf" (should NOT appear)
# Cmd+P → "reproduce.sh" (should appear)
```

### Test 3: Verify SST Propagation
```bash
# Add pattern to .gitignore
echo "*.test" >> .gitignore

# Regenerate
make cursor-indexing-ignore

# Verify it appears in .cursorindexingignore
grep "*.test" .cursorindexingignore
```

## Troubleshooting

### Issue: .cursorindexingignore Not Updating

**Cause**: Script not being run  
**Fix**: `make cursor-indexing-ignore`

### Issue: Patterns in .gitignore Not Appearing

**Cause**: Script may be filtering them out  
**Check**: Look at script's `grep -v` filters  
**Fix**: Adjust filters or add to Section 2

### Issue: Cursor Still Indexing Excluded Files

**Cause**: Cursor hasn't re-indexed  
**Fix**: Cmd+Shift+P → "Developer: Reload Window"

## Related Documentation

- **Implementation**: `@resources/scripts/generate-cursorindexingignore.sh`
- **Usage**: `Makefile` → `cursor-indexing-ignore` target
- **Strategy**: `README_IF_YOU_ARE_AN_AI/CURSOR_INDEXING_STRATEGY.md`
- **Analysis**: `CURSOR_INDEXING_ANALYSIS.md`

## Future Enhancements

### Enhancement 1: Pre-Commit Hook
**Status**: Proposed  
**Benefit**: Automatic regeneration on `.gitignore` changes

### Enhancement 2: Validation
**Status**: Proposed  
**Benefit**: Ensure `.cursorindexingignore` is up to date in CI

### Enhancement 3: Pattern Analysis
**Status**: Proposed  
**Benefit**: Report which patterns are Git-only vs Cursor-only

## Summary

**SST Pattern**: `.gitignore` (master) → generates → `.cursorindexingignore`

**Benefits**:
- ✅ No duplication
- ✅ No drift
- ✅ Easy maintenance
- ✅ Clear ownership

**Usage**: `make cursor-indexing-ignore`

**Philosophy**: Following project's SST principle (like `setup-latex-minimal.sh` for LaTeX installation)

---

**Last Updated**: 2025-11-01  
**Status**: ✅ Implemented and tested  
**Pattern**: Single Source of Truth (SST)

